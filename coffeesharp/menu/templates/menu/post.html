{% extends 'base.html' %}

{% block content %}
  <h1>{{ post.title }}</h1>

{% block breadcrumbs %}
    {% with post.tags.all as tags %}
        {% if tags %}
            <ul class="tags-list">
                <li>–¢–µ–≥–∏:</li>
                {% for t in tags %}
                    <li><a href="{{ t.get_absolute_url }}">{{ t.tag }}</a></li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
{% endblock %}

{% if post.photo %}
    <div class="cover">
        <img class="img-article-left" src="{{ post.photo.url }}" alt="{{ post.title }}">
    </div>
{% endif %}

<div class="post-content" style="margin-bottom: 20px;">
    {{ post.content|linebreaks }}
    <div class="post-reactions" style="margin-bottom: 30px;">
    {% if user.is_authenticated %}
        <form method="post" style="display: flex; align-items: center; gap: 15px;">
            {% csrf_token %}
            <button type="submit" name="reaction" value="like"
                    style="font-size: 24px; background: none; border: none; cursor: pointer;
                           {% if user_reaction == 'like' %}color:red; font-weight:bold;{% endif %}">
                ‚ù§Ô∏è {{ likes }}
            </button>
            <button type="submit" name="reaction" value="dislike"
                    style="font-size: 24px; background: none; border: none; cursor: pointer;
                           {% if user_reaction == 'dislike' %}color:darkred; font-weight:bold;{% endif %}">
                üëéüèª {{ dislikes }}
            </button>
        </form>
    {% else %}
        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="{% url 'users:login' %}?next={{ request.path }}"
               style="font-size: 24px; text-decoration: none; color: inherit;">
                ‚ù§Ô∏è {{ likes }}
            </a>
            <a href="{% url 'users:login' %}?next={{ request.path }}"
               style="font-size: 24px; text-decoration: none; color: inherit;">
                üëéüèª {{ dislikes }}
            </a>
        </div>
    {% endif %}
</div>

</div>

<!-- üîª –†–µ–∞–∫—Ü–∏–∏ –ø—Ä—è–º–æ –ø–æ–¥ —Ç–µ–∫—Å—Ç–æ–º -->


<div class="post-actions" style="margin-bottom: 20px;">
    {% if perms.menu.change_menu %}
        <p><a href="{% url 'edit_page' post.slug %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a></p>
        <p><a href="{% url 'delete_page' post.slug %}">–£–¥–∞–ª–∏—Ç—å</a></p>
    {% endif %}
</div>

<!-- üîª –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
<div class="feedback-block" style="margin-top: 40px; background: #f5f5f5; padding: 20px; border-radius: 10px;">
    <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
    {% for comment in comments %}
    <div style="margin-bottom: 15px; padding: 10px; background: #fff; border: 1px solid #ccc; border-radius: 5px;">
        <strong>{{ comment.author }}</strong><br>
        {{ comment.content }}<br>
        <small style="color: #777;">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
        {% if user == comment.author or user.is_staff %}
            <div style="margin-top: 5px;">
                <a href="{% url 'edit_comment' comment.pk %}" style="margin-right: 10px;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                <a href="{% url 'delete_comment' comment.pk %}" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?');">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
            </div>
        {% endif %}
    </div>
{% empty %}
    <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
{% endfor %}


    {% if user.is_authenticated %}
        <h4 style="margin-top: 30px;">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
        <form method="post">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <button type="submit" name="comment_submit" style="margin-top: 10px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    {% else %}
        <p><a href="{% url 'users:login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
    {% endif %}
</div>
{% endblock %}